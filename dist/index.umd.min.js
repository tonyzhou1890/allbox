!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Allbox=e()}(this,function(){"use strict";function i(t,e,r){var n=t[e];return t[e]=t[r],t[r]=n,t}function h(t){let e=Object.prototype.toString.call(t).slice(8,-1);return e="Object"===e?t.constructor.name:e}function o(t,e){return Math.random()*(e-t)+t}function n(t,e){if(t===e)return[t,e];var r;e<t&&(r=e,e=t,t=r);const n=[0,0];return n[0]=o(t,e),n[1]=o(t,e),n}function f(t,e,r){return t>>e&(1<<r)-1}function a(t,e,r,n){return((1<<r)-1&n)<<e|t}function c(t){let e=1;for(;t>2**e;)e++;return e}function g(t,e,r){let n=e/8>>0,o=r=null!=r?r:1,i=e%8,l=0,a=!0;for(;0<o;){var f=8-i,u=o>f?f:o;a||(l<<=u),a=!1,l+=t[n]>>f-u&(1<<u)-1,o-=u,i=0,n++}return l}function s(t,e,r,n){var o=n=null!=n?n:c(r);let i=e/8>>0,l=e%8;for(;n;){var a=8-l,f=n<=a?n:a,u=r>>(n-=f)&(1<<f)-1;t[i]=t[i]|u<<a-f,l=0,i++}return e+o}function m(t){var e=new Array(256);return function t(e,r,n,o){if(!e.left&&!e.right)return void(n[e.num]={code:r,bitLength:o});e.left&&t(e.left,r<<1,n,o+1);e.right&&t(e.right,1+(r<<1),n,o+1)}(t,0,e,0),e}function p(t,o=0,i=g){return function t(e){const r={};const n=i(e,o);o++;if(n)return r.num=i(e,o,8),o+=8,r;r.left=t(e);r.right=t(e);return r}(t)}function d(t){for(;1<t.length;){t.sort((t,e)=>t.freq-e.freq);const r={};var e;r.left=t.shift(),r.right=t.shift(),r.left.freq==r.left.freq&&void 0!==r.left.depth&&void 0!==r.right.depth&&r.left.depth>r.right.depth&&(e=r.left,r.left=r.right,r.right=e),r.freq=r.left.freq+r.right.freq,r.depth=Math.max(r.left.depth||0,r.right.depth||0)+1,t.push(r)}return t[0]}function v(t,n=s){const e=new Uint8Array(514);let o=16;!function t(e,r){{if(void 0!==e.num)return o=n(r,o,1,1),void(o=n(r,o,e.num,8));o=n(r,o,0,1)}e.left&&t(e.left,r);e.right&&t(e.right,r)}(t,e);t=Math.ceil(o/8)-2;return e[0]=t>>8,e[1]=255&t,e.slice(0,2+t)}function l(r,n,o){var i=n[1][0]-n[0][0],l=n[1][1]-n[0][1],a=o[1][0]-o[0][0],f=o[1][1]-o[0][1];for(let t=0,e=r.length;t<e;t++){const u=r[t];u[0]=(u[0]-n[0][0])/i,u[1]=(u[1]-n[0][1])/l,u[0]=u[0]*a+o[0][0],u[1]=u[1]*f+o[0][1]}return r}const e=/-(\w)/g;const r=/\B([A-Z])/g;return{array:{randomSwap:function(r,n,o){if(!("Array"!==h(r)||r.length<2)){("Number"!==h(n)||n<0)&&(n=0);for(let t=0,e=(o="Number"!==h(o)||o>r.length?r.length:o)-n;t<e;t++)i(r,Math.random()*e+n>>0,Math.random()*e+n>>0)}return r},randomVector2:n,swap:i},bitKit:{bigEndian:{read:function(t,e,r){r=null!=r?r:1;let n=e/8>>0,o=e%8,i=0;for(;r;){var l=8-o>r?r:8-o;i+=f(t[n],o,l),e+=l,8===(o+=l)&&(n++,o=0),r-=l,i<<=r}return i},write:function(t,e,r,n){n=null!=n?n:c(r);let o=e/8>>0,i=e%8;for(;n;){var l=8-i>n?n:8-i;n-=l,t[o]=a(t[o],i,l,r>>n),e+=l,8===(i+=l)&&(o++,i=0)}return e}},getBitLengthOfNumber:c,getBits:f,get:g,littleEndian:{read:function(t,e,r){var n=r=null!=r?r:1;let o=e/8>>0,i=e%8,l=0;for(;r;){var a=8-i>r?r:8-i;l+=f(t[o],i,a)<<n-r,e+=a,8===(i+=a)&&(o++,i=0),r-=a}return l},write:function(t,e,r,n){n=null!=n?n:c(r);let o=e/8>>0,i=e%8;for(;n;){var l=8-i>n?n:8-i;t[o]=a(t[o],i,l,r),r>>=l,n-=l,e+=l,8===(i+=l)&&(o++,i=0)}return e}},put:s,reverse:function(t,e){let r=0;for(;e;)r=(r<<1)+(1&t),t>>=1,e--;return r},setBits:a},common:{getTypeName:h},compress:{huffman:{buildTable:m,buildTrieFromTable:p,buildTrie:d,decode:function(e){if("Uint8Array"!==h(e))throw new Error("Huffman.decode 的参数需要是 Uint8Array");const t=g;var r=(e[0]<<8)+e[1],n=m(p(e.slice(2,r+2),void 0,t));const o={};for(let t=0,e=n.length;t<e;t++)void 0!==n[t]&&(o[n[t].code+"_"+n[t].bitLength]=t);let i=0;for(let t=0;t<4;t++)i&&(i<<=8),i+=e[r+2+t];const l=new Uint8Array(i);var a,f=e.slice(r+6);let u=0,c=0,s=0,d=void 0;for(;u<i;){for(s=0,d=void 0;void 0===d;)if(s++,a=t(f,c,s),d=o[a+"_"+s],256<s)throw new Error("解压错误");l[u]=d,c+=s,u++}return l},encode:function(r){if("Uint8Array"!==h(r))throw new Error("Huffman.encode 的参数需要是 Uint8Array");const n=s;let o=new Array(256).fill(0);for(let t=0,e=r.length;t<e;t++)o[r[t]]++;var t=d(o=o.map((t,e)=>({num:e,freq:t})).filter(t=>t.freq)),i=m(t);let l=new Uint8Array(r.length+4);for(let t=0;t<4;t++)l[t]=r.length>>8*(3-t)&255;let a=32;for(let t=0,e=r.length;t<e;t++){var f=i[r[t]].bitLength;if(a+f>8*l.length){const u=new Uint8Array(l.length+1e3);u.set(l),l=u}a=n(l,a,i[r[t]].code,f)}l=l.slice(0,Math.ceil(a/8)),t=v(t,n);const e=new Uint8Array(l.length+t.length);return e.set(t),e.set(l,t.length),e},saveTable:v}},graphic:{randomScatter:function(t,e){e=Math.max(e,0);const r=[];for(let t=0;t<e;t++)r.push(n(0,1));return l(r,[[0,0],[1,1]],t),r},vector2Mapping:l},number:{randomRange:o},string:{camelize:function(t){return t.replace(e,(t,e)=>e?e.toUpperCase():"")},hyphenate:t=>t.replace(r,"-$1").toLowerCase()},worker:function(r){const n=h(r);if("String"!==n&&"Function"!==n)throw new Error("worker 参数类型错误");var t=Math.max(window.navigator.hardwareConcurrency-1,1);const o=new Map,i=[],l=new Array(t).fill(null).map((t,e)=>({index:e,worker:"String"===n?new Worker(r):r(),idle:!0}));function a(){let t=null;var e;i.length&&(t=l.find(t=>t.idle))&&(t.idle=!1,e=i.shift(),o.set(e._sign,e.p),t.worker.postMessage(Object.assign(Object.assign({},e.job),{_sign:e._sign})))}return l.map(e=>{e.worker.addEventListener("message",t=>{t.data&&t.data._sign?(o.get(t.data._sign).resolve(t.data.result),o.delete(t.data._sign),e.idle=!0,a()):(console.error("worker 返回数据错误"),o.get(t.data._sign).reject("worker 返回数据错误"))})}),new Proxy({},{get(t,o){return function(...n){return new Promise((t,e)=>{var r=Date.now()*Math.random();i.push({_sign:r,job:{action:o,param:n},p:{resolve:t,reject:e}}),a()})}}})}}});
