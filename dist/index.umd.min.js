!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Allbox=t()}(this,function(){"use strict";function r(e){return e.length===[...new Set(e)].length}function i(e,t,r){var n=e[t];return e[t]=e[r],e[r]=n,e}function g(e){let t=Object.prototype.toString.call(e).slice(8,-1);return t="Object"===t?e.constructor.name:t}function o(e,t){return Math.random()*(t-e)+e}function n(e,t){if(e===t)return[e,t];var r;t<e&&(r=t,t=e,e=r);const n=[0,0];return n[0]=o(e,t),n[1]=o(e,t),n}function f(e,t,r){return e>>t&(1<<r)-1}function l(e,t,r,n){return((1<<r)-1&n)<<t|e}function c(e){let t=1;for(;e>2**t;)t++;return t}function d(e,t,r){let n=t/8>>0,o=r=r??1,i=t%8,a=0,l=!0;for(;0<o;){var f=8-i,u=o>f?f:o;l||(a<<=u),l=!1,a+=e[n]>>f-u&(1<<u)-1,o-=u,i=0,n++}return a}function s(e,t,r,n){var o=n=n??c(r);let i=t/8>>0,a=t%8;for(;n;){var l=8-a,f=n<=l?n:l,u=r>>(n-=f)&(1<<f)-1;e[i]=e[i]|u<<l-f,a=0,i++}return t+o}function p(e){var t=new Array(256);return function e(t,r,n,o){if(!t.left&&!t.right)return void(n[t.num]={code:r,bitLength:o});t.left&&e(t.left,r<<1,n,o+1);t.right&&e(t.right,1+(r<<1),n,o+1)}(e,0,t,0),t}function w(e,o=0,i=d){return function e(t){const r={};const n=i(t,o);o++;if(n)return r.num=i(t,o,8),o+=8,r;r.left=e(t);r.right=e(t);return r}(e)}function h(e){for(;1<e.length;){e.sort((e,t)=>e.freq-t.freq);const r={};var t;r.left=e.shift(),r.right=e.shift(),r.left.freq==r.left.freq&&void 0!==r.left.depth&&void 0!==r.right.depth&&r.left.depth>r.right.depth&&(t=r.left,r.left=r.right,r.right=t),r.freq=r.left.freq+r.right.freq,r.depth=Math.max(r.left.depth||0,r.right.depth||0)+1,e.push(r)}return e[0]}function m(e,n=s){const t=new Uint8Array(514);let o=16;!function e(t,r){{if(void 0!==t.num)return o=n(r,o,1,1),void(o=n(r,o,t.num,8));o=n(r,o,0,1)}t.left&&e(t.left,r);t.right&&e(t.right,r)}(e,t);e=Math.ceil(o/8)-2;return t[0]=e>>8,t[1]=255&e,t.slice(0,2+e)}function a(r,n,o){var i=n[1][0]-n[0][0],a=n[1][1]-n[0][1],l=o[1][0]-o[0][0],f=o[1][1]-o[0][1];for(let e=0,t=r.length;e<t;e++){const u=r[e];u[0]=(u[0]-n[0][0])/i,u[1]=(u[1]-n[0][1])/a,u[0]=u[0]*l+o[0][0],u[1]=u[1]*f+o[0][1]}return r}const t=/-(\w)/g;const u=/\B([A-Z])/g;return{array:{isUnique:r,randomSwap:function(r,n,o){if(!("Array"!==g(r)||r.length<2)){("Number"!==g(n)||n<0)&&(n=0);for(let e=0,t=(o="Number"!==g(o)||o>r.length?r.length:o)-n;e<t;e++)i(r,Math.random()*t+n>>0,Math.random()*t+n>>0)}return r},randomVector2:n,swap:i},bitKit:{bigEndian:{read:function(e,t,r){r=r??1;let n=t/8>>0,o=t%8,i=0;for(;r;){var a=8-o>r?r:8-o;i+=f(e[n],o,a),t+=a,8===(o+=a)&&(n++,o=0),r-=a,i<<=r}return i},write:function(e,t,r,n){n=n??c(r);let o=t/8>>0,i=t%8;for(;n;){var a=8-i>n?n:8-i;n-=a,e[o]=l(e[o],i,a,r>>n),t+=a,8===(i+=a)&&(o++,i=0)}return t}},getBitLengthOfNumber:c,getBits:f,get:d,littleEndian:{read:function(e,t,r){var n=r=r??1;let o=t/8>>0,i=t%8,a=0;for(;r;){var l=8-i>r?r:8-i;a+=f(e[o],i,l)<<n-r,t+=l,8===(i+=l)&&(o++,i=0),r-=l}return a},write:function(e,t,r,n){n=n??c(r);let o=t/8>>0,i=t%8;for(;n;){var a=8-i>n?n:8-i;e[o]=l(e[o],i,a,r),r>>=a,n-=a,t+=a,8===(i+=a)&&(o++,i=0)}return t}},put:s,reverse:function(e,t){let r=0;for(;t;)r=(r<<1)+(1&e),e>>=1,t--;return r},setBits:l},common:{getTypeName:g},compress:{huffman:{buildTable:p,buildTrieFromTable:w,buildTrie:h,decode:function(t){if("Uint8Array"!==g(t))throw new Error("Huffman.decode 的参数需要是 Uint8Array");const e=d;var r=(t[0]<<8)+t[1],n=p(w(t.slice(2,r+2),void 0,e));const o={};for(let e=0,t=n.length;e<t;e++)void 0!==n[e]&&(o[n[e].code+"_"+n[e].bitLength]=e);let i=0;for(let e=0;e<4;e++)i&&(i<<=8),i+=t[r+2+e];const a=new Uint8Array(i);var l,f=t.slice(r+6);let u=0,c=0,s=0,h=void 0;for(;u<i;){for(s=0,h=void 0;void 0===h;)if(s++,l=e(f,c,s),h=o[l+"_"+s],256<s)throw new Error("解压错误");a[u]=h,c+=s,u++}return a},encode:function(r){if("Uint8Array"!==g(r))throw new Error("Huffman.encode 的参数需要是 Uint8Array");const n=s;let o=new Array(256).fill(0);for(let e=0,t=r.length;e<t;e++)o[r[e]]++;var e=h(o=o.map((e,t)=>({num:t,freq:e})).filter(e=>e.freq)),i=p(e);let a=new Uint8Array(r.length+4);for(let e=0;e<4;e++)a[e]=r.length>>8*(3-e)&255;let l=32;for(let e=0,t=r.length;e<t;e++){var f=i[r[e]].bitLength;if(l+f>8*a.length){const u=new Uint8Array(a.length+1e3);u.set(a),a=u}l=n(a,l,i[r[e]].code,f)}a=a.slice(0,Math.ceil(l/8)),e=m(e,n);const t=new Uint8Array(a.length+e.length);return t.set(e),t.set(a,e.length),t},saveTable:m}},graphic:{randomScatter:function(e,t){t=Math.max(t,0);const r=[];for(let e=0;e<t;e++)r.push(n(0,1));return a(r,[[0,0],[1,1]],e),r},vector2Mapping:a},number:{baseConvert:function(e,n,o,i=32){if(!e)return"";if(!r(n))throw new Error("There are duplicated elements in sourceTable");if(!r(o))throw new Error("There are duplicated elements in targetTable");const t=new RegExp(`^[${n.join("")}.]+$`);if(!t.test(e))throw new Error("source does not match with sourceTable");if(1<e.split("").filter(e=>"."===e).length)throw new Error("There are too many dots in source string");let a="";if((e=e.split(".").filter(e=>e))[0]&&e[0].length){const h={};var l=[...n];for(let e=0;e<l.length;e++)h[l[e]]=BigInt(e);var f=e[0];const g=[];var u=BigInt(n.length),c=BigInt(o.length);let t=0n,r=1n;for(let e=f.length-1;0<=e;e--)t+=h[f[e]]*r,r*=u;for(;0n!==t;)g.push(o[Number(t%c)]),t/=c;if(a=(a=g.reverse().join(""))||o[0],e[1]){var s=e[1];const d=[],p=[0n,1n];for(let e=0;e<s.length;e++)p[1]*=u;let t=1n;for(let e=0;e<s.length;e++)t*=u,p[0]+=p[1]/t*h[s[e]];for(;d.length<i&&0n!==p[0];)p[0]*=c,d.push(o[Number(p[0]/p[1])]),p[0]%=p[1];for(;d.length&&d[d.length-1]===o[0];)d.pop();d.length&&(a=a+"."+d.join(""))}}return a},randomRange:o},string:{camelize:function(e){return e.replace(t,(e,t)=>t?t.toUpperCase():"")},hyphenate:e=>e.replace(u,"-$1").toLowerCase()},tree:{flat:function(e,t=!1,o="children"){const i=[],r=[...e];if(t)!function r(n){for(let e=0,t=n.length;e<t;e++)i.push(n[e]),Array.isArray(n[e][o])&&r(n[e][o])}(e);else for(;r.length;){var n=r.shift();i.push(n),Array.isArray(n[o])&&r.push(...n[o])}return i}},worker:{create:function(r){const n=g(r);if("String"!==n&&"Function"!==n)throw new Error("worker 参数类型错误");var e=Math.max(window.navigator.hardwareConcurrency-1,1);const o=new Map,i=[],a=new Array(e).fill(null).map((e,t)=>({index:t,worker:"String"===n?new Worker(r):r(),idle:!0}));function l(){let e=null;var t;i.length&&(e=a.find(e=>e.idle))&&(e.idle=!1,t=i.shift(),o.set(t._sign,t.p),e.worker.postMessage({...t.job,_sign:t._sign}))}return a.map(t=>{t.worker.addEventListener("message",e=>{e.data&&e.data._sign?(o.get(e.data._sign).resolve(e.data.result),o.delete(e.data._sign),t.idle=!0,l()):(console.error("worker 返回数据错误"),o.get(e.data._sign).reject("worker 返回数据错误"))})}),new Proxy({},{get(e,o){return function(...n){return new Promise((e,t)=>{var r=Date.now()*Math.random();i.push({_sign:r,job:{action:o,param:n},p:{resolve:e,reject:t}}),l()})}}})},thread:function(n){return function(e){var{action:e,param:t=[],_sign:r}=e.data;"function"==typeof n[e]?(t={action:e,result:n[e](...t),_sign:r},postMessage(t)):console.log(`指定操作${e}不存在`)}}}}});
