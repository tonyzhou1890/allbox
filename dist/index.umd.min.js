!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Allbox=t()}(this,function(){"use strict";function r(e){return e.length===[...new Set(e)].length}function o(e,t,r){var n=e[t];return e[t]=e[r],e[r]=n,e}function d(e){let t=Object.prototype.toString.call(e).slice(8,-1);return t="Object"===t?e.constructor.name:t}function i(e,t){return Math.random()*(t-e)+e}function n(e,t){if(e===t)return[e,t];var r;t<e&&(r=t,t=e,e=r);const n=[0,0];return n[0]=i(e,t),n[1]=i(e,t),n}function s(e,t,r){return e>>t&(1<<r)-1}function l(e,t,r,n){return((1<<r)-1&n)<<t|e}function f(e){let t=1;for(;e>2**t;)t++;return t}function p(e,t,r){let n=t/8>>0,i=r=r??1,o=t%8,a=0,l=!0;for(;0<i;){var s=8-o,u=i>s?s:i;l||(a<<=u),l=!1,a+=e[n]>>s-u&(1<<u)-1,i-=u,o=0,n++}return a}function c(e,t,r,n){var i=n=n??f(r);let o=t/8>>0,a=t%8;for(;n;){var l=8-a,s=n<=l?n:l,u=r>>(n-=s)&(1<<s)-1;e[o]=e[o]|u<<l-s,a=0,o++}return t+i}function g(e){var t=new Array(256);return function e(t,r,n,i){if(!t.left&&!t.right)return void(n[t.num]={code:r,bitLength:i});t.left&&e(t.left,r<<1,n,i+1);t.right&&e(t.right,1+(r<<1),n,i+1)}(e,0,t,0),t}function v(e,i=0,o=p){return function e(t){const r={};const n=o(t,i);i++;if(n)return r.num=o(t,i,8),i+=8,r;r.left=e(t);r.right=e(t);return r}(e)}function h(e){for(;1<e.length;){e.sort((e,t)=>e.freq-t.freq);const r={};var t;r.left=e.shift(),r.right=e.shift(),r.left.freq==r.left.freq&&void 0!==r.left.depth&&void 0!==r.right.depth&&r.left.depth>r.right.depth&&(t=r.left,r.left=r.right,r.right=t),r.freq=r.left.freq+r.right.freq,r.depth=Math.max(r.left.depth||0,r.right.depth||0)+1,e.push(r)}return e[0]}function m(e,n=c){const t=new Uint8Array(514);let i=16;!function e(t,r){{if(void 0!==t.num)return i=n(r,i,1,1),void(i=n(r,i,t.num,8));i=n(r,i,0,1)}t.left&&e(t.left,r);t.right&&e(t.right,r)}(e,t);e=Math.ceil(i/8)-2;return t[0]=e>>8,t[1]=255&e,t.slice(0,2+e)}function a(r,n,i){var o=n[1][0]-n[0][0],a=n[1][1]-n[0][1],l=i[1][0]-i[0][0],s=i[1][1]-i[0][1];for(let e=0,t=r.length;e<t;e++){const u=r[e];u[0]=(u[0]-n[0][0])/o,u[1]=(u[1]-n[0][1])/a,u[0]=u[0]*l+i[0][0],u[1]=u[1]*s+i[0][1]}return r}const w={field:"field",value:"value"};const t=/-(\w)/g;const u=/\B([A-Z])/g;return{array:{isUnique:r,randomSwap:function(r,n,i){if(!("Array"!==d(r)||r.length<2)){("Number"!==d(n)||n<0)&&(n=0);for(let e=0,t=(i="Number"!==d(i)||i>r.length?r.length:i)-n;e<t;e++)o(r,Math.random()*t+n>>0,Math.random()*t+n>>0)}return r},randomVector2:n,swap:o},bitKit:{bigEndian:{read:function(e,t,r){r=r??1;let n=t/8>>0,i=t%8,o=0;for(;r;){var a=8-i>r?r:8-i;o+=s(e[n],i,a),t+=a,8===(i+=a)&&(n++,i=0),r-=a,o<<=r}return o},write:function(e,t,r,n){n=n??f(r);let i=t/8>>0,o=t%8;for(;n;){var a=8-o>n?n:8-o;n-=a,e[i]=l(e[i],o,a,r>>n),t+=a,8===(o+=a)&&(i++,o=0)}return t}},getBitLengthOfNumber:f,getBits:s,get:p,littleEndian:{read:function(e,t,r){var n=r=r??1;let i=t/8>>0,o=t%8,a=0;for(;r;){var l=8-o>r?r:8-o;a+=s(e[i],o,l)<<n-r,t+=l,8===(o+=l)&&(i++,o=0),r-=l}return a},write:function(e,t,r,n){n=n??f(r);let i=t/8>>0,o=t%8;for(;n;){var a=8-o>n?n:8-o;e[i]=l(e[i],o,a,r),r>>=a,n-=a,t+=a,8===(o+=a)&&(i++,o=0)}return t}},put:c,reverse:function(e,t){let r=0;for(;t;)r=(r<<1)+(1&e),e>>=1,t--;return r},setBits:l},compress:{huffman:{buildTable:g,buildTrieFromTable:v,buildTrie:h,decode:function(t){if("Uint8Array"!==d(t))throw new Error("Huffman.decode 的参数需要是 Uint8Array");const e=p;var r=(t[0]<<8)+t[1],n=g(v(t.slice(2,r+2),void 0,e));const i={};for(let e=0,t=n.length;e<t;e++)void 0!==n[e]&&(i[n[e].code+"_"+n[e].bitLength]=e);let o=0;for(let e=0;e<4;e++)o&&(o<<=8),o+=t[r+2+e];const a=new Uint8Array(o);var l,s=t.slice(r+6);let u=0,f=0,c=0,h=void 0;for(;u<o;){for(c=0,h=void 0;void 0===h;)if(c++,l=e(s,f,c),h=i[l+"_"+c],256<c)throw new Error("解压错误");a[u]=h,f+=c,u++}return a},encode:function(r){if("Uint8Array"!==d(r))throw new Error("Huffman.encode 的参数需要是 Uint8Array");const n=c;let i=new Array(256).fill(0);for(let e=0,t=r.length;e<t;e++)i[r[e]]++;var e=h(i=i.map((e,t)=>({num:t,freq:e})).filter(e=>e.freq)),o=g(e);let a=new Uint8Array(r.length+4);for(let e=0;e<4;e++)a[e]=r.length>>8*(3-e)&255;let l=32;for(let e=0,t=r.length;e<t;e++){var s=o[r[e]].bitLength;if(l+s>8*a.length){const u=new Uint8Array(a.length+1e3);u.set(a),a=u}l=n(a,l,o[r[e]].code,s)}a=a.slice(0,Math.ceil(l/8)),e=m(e,n);const t=new Uint8Array(a.length+e.length);return t.set(e),t.set(a,e.length),t},saveTable:m}},graphic:{randomScatter:function(e,t){t=Math.max(t,0);const r=[];for(let e=0;e<t;e++)r.push(n(0,1));return a(r,[[0,0],[1,1]],e),r},vector2Mapping:a},math:{pi:function(t=32){t=Math.max(0,t);let r=10n,n=5n;var i=5n*5n;let o=239n;var a,l=239n*239n;let s=4n*o-n,u=n*o;for(let e=1;e<=t;e++)r*=10n,a=2n*BigInt(e)+1n,n*=i,o*=l,a=a*n*o,s*=a,e%2==1?s-=(4n*o-n)*u:s+=(4n*o-n)*u,u*=a;const e=4n*r*s/u;var f=e.toString().substring(1,t+1);return t?"3."+f:"3"}},number:{baseConvert:function(e,n,i,o=32){if(!e)return"";if(!r(n))throw new Error("There are duplicated elements in sourceTable");if(!r(i))throw new Error("There are duplicated elements in targetTable");const t=new RegExp(`^[${n.join("")}.]+$`);if(!t.test(e))throw new Error("source does not match with sourceTable");if(1<e.split("").filter(e=>"."===e).length)throw new Error("There are too many dots in source string");let a="";if((e=e.split(".").filter(e=>e))[0]&&e[0].length){const h={};var l=[...n];for(let e=0;e<l.length;e++)h[l[e]]=BigInt(e);var s=e[0];const d=[];var u=BigInt(n.length),f=BigInt(i.length);let t=0n,r=1n;for(let e=s.length-1;0<=e;e--)t+=h[s[e]]*r,r*=u;for(;0n!==t;)d.push(i[Number(t%f)]),t/=f;if(a=(a=d.reverse().join(""))||i[0],e[1]){var c=e[1];const p=[],g=[0n,1n];for(let e=0;e<c.length;e++)g[1]*=u;let t=1n;for(let e=0;e<c.length;e++)t*=u,g[0]+=g[1]/t*h[c[e]];for(;p.length<o&&0n!==g[0];)g[0]*=f,p.push(i[Number(g[0]/g[1])]),g[0]%=g[1];for(;p.length&&p[p.length-1]===i[0];)p.pop();p.length&&(a=a+"."+p.join(""))}}return a},format:{thousandsSep:function(e){const t=e.toString().split(".");return[t[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,function(e,t){return t+","}),t[1]].filter(e=>e).join(".")}},randomRange:i},other:{angleConvert:function(e,t,r){let n=e;switch(t+r){case"DR":n=e/180*Math.PI;break;case"RD":n=e/Math.PI*180}return n},bmi:function(e,t){return t/(e*e/1e4)},getTypeName:d,searchPatternCheck:function(t,e,r=!1){const n={valid:!0,patterns:[],step:"",options:[],optional:!1};"/"!==(e=e.trimStart())[0]?":"!==e[0]&&(e=":"+e):e=e.slice(1);var i=e.split("/");const o=[];for(let e=0;e<i.length;e++){var a=!r&&e===i.length-1,a=function(e,t,r){const n=t.split(":"),i={field:"",rawValue:"",values:[],valid:!0},o=function(e,t,r){const n={valid:!0,field:t};r?(n.step=w.field,n.options=e.patterns?.filter?.(e=>e.field&&e.field?.startsWith(t)).map(e=>e.field),n.optional=!n.field&&e.patterns.some(e=>!e.field)):(n.pattern=e.patterns.find(e=>e.field===t),n.valid=!!n.pattern);return n}(e,n[0],r&&1===n.length);return Object.assign(i,o),i.rawValue=n.slice(1).join(":"),o.valid&&!o.step&&o.pattern&&(t=function(e,t,r){const n={values:[],valid:!0},i=(n.multiple=e?.multiple,n.seperator=e?.seperator||"-",n.presetedValues=e?.values,n.multiple&&n.seperator&&t?t.split(n.seperator):[t].filter(e=>e));r?(n.options=n.presetedValues,n.optional=!e?.values?.length,n.step=w.value):!n.presetedValues?.length||(n.valid=i.every(e=>n.presetedValues?.includes(e)),n.valid)?n.values=i:n.step=w.value;return n}(i.pattern,i.rawValue,r),Object.assign(i,t)),i}(t,i[e],a);o.push(a)}if(n.patterns=o,n.patterns.length){var l=n,e=r,s=l.patterns.find(e=>!e.valid);if(s)l.valid=!1,l.errorPattern=s;else if(e){l.patterns.map(e=>{e.valid&&e.field&&!e.values.length&&(e.valid=!1,e.step=w.value),!e.valid&&l.valid&&(l.valid=!1,l.errorPattern=e)});const u={};l.patterns.map(e=>{var t=e.field||"default";u[t]=e.pattern?.multiple?e.values:e.values[0]??""}),l.pairs=u}else{s=l.patterns.slice(-1)[0];l.step=s.step??"",l.options=s.options??[]}}return console.log(n),n},temperatureConvert:function(e,t,r){let n=e;switch(t+r){case"CF":n=1.8*e+32;break;case"CK":n=e+273.15;break;case"FC":n=(e-32)/1.8;break;case"FK":n=5*(e+459.67)/9;break;case"KC":n=e-273.15;break;case"KF":n=1.8*e-459.67}return n}},string:{camelize:function(e){return e.replace(t,(e,t)=>t?t.toUpperCase():"")},hyphenate:e=>e.replace(u,"-$1").toLowerCase()},tree:{flat:function(e,t=!1,i="children"){const o=[],r=[...e];if(t)!function r(n){for(let e=0,t=n.length;e<t;e++)o.push(n[e]),Array.isArray(n[e][i])&&r(n[e][i])}(e);else for(;r.length;){var n=r.shift();o.push(n),Array.isArray(n[i])&&r.push(...n[i])}return o}},validate:{isEmpty:function(e){return null==e||""===e}},worker:{create:function(r){const n=d(r);if("String"!==n&&"Function"!==n)throw new Error("worker 参数类型错误");var e=Math.max(window.navigator.hardwareConcurrency-1,1);const i=new Map,o=[],a=new Array(e).fill(null).map((e,t)=>({index:t,worker:"String"===n?new Worker(r):r(),idle:!0}));function l(){let e=null;var t;o.length&&(e=a.find(e=>e.idle))&&(e.idle=!1,t=o.shift(),i.set(t._sign,t.p),e.worker.postMessage({...t.job,_sign:t._sign}))}return a.map(t=>{t.worker.addEventListener("message",e=>{e.data&&e.data._sign?(i.get(e.data._sign).resolve(e.data.result),i.delete(e.data._sign),t.idle=!0,l()):(console.error("worker 返回数据错误"),i.get(e.data._sign).reject("worker 返回数据错误"))})}),new Proxy({},{get(e,i){return function(...n){return new Promise((e,t)=>{var r=Date.now()*Math.random();o.push({_sign:r,job:{action:i,param:n},p:{resolve:e,reject:t}}),l()})}}})},thread:function(n){return function(e){var{action:e,param:t=[],_sign:r}=e.data;"function"==typeof n[e]?(t={action:e,result:n[e](...t),_sign:r},postMessage(t)):console.log(`指定操作${e}不存在`)}}}}});
